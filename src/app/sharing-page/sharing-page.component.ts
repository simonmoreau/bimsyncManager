import { AfterViewInit, Component, OnInit } from '@angular/core';
import * as $ from 'jquery';
import { flatten } from '@angular/compiler';

declare var bimsync: any;



@Component({
  selector: 'app-sharing-page',
  templateUrl: './sharing-page.component.html',
  styleUrls: ['./sharing-page.component.scss']
})
export class SharingPageComponent implements OnInit, AfterViewInit {

  spacesVisibility: boolean = false;
  twoDVisibility: boolean = true;
  models: IModel[] = [];

  constructor() { }

  ngOnInit() {
    this.models = [
      { "id": 'c31e78d3f764460f830bfef908e42950', "name": "Model 1 aaaa", "isVisible":true},
      { "id": 'c31e78d3f764460f830bfef908e42950', "name": "Model 2 aaaaaaaaaaaaaaaa", "isVisible":true},
      { "id": 'c31e78d3f764460f830bfef908e42950', "name": "Model 3 aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa", "isVisible":true}
  ];
  }

  ngAfterViewInit() {

    let $viewer = $('#viewer-3d') as any;
    let $viewer2d = $('#viewer-2d') as any;

    let demoTokenUrl = 'https://demo.bimsync.com';
    let viewer2dUrl = 'https://api.bimsync.com/beta/viewer2d/svg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ0eXBlIjoidmlld2VyLTJkIiwiZXhwIjoxNTM0NTMyNDQ2LCJyZXZpc2lvbi1pZCI6ImI5MTE4NzA4NDZjNzQ4NmM5ZWM3ZDljZTNjOGZlZjliIiwidmlld2VyMmQtaWQiOiIxMzM1ZWYyNC01M2RhLTQzNjYtOGY2ZC1lZGQ1YzBiYjYxYjgifQ.J7qjjLrPnR6sB41oPGdmh9n38h5UTxvBYFLA81X_wLw';
    let viewer3dUrl = 'https://api.bimsync.com/1.0/viewer/access?token=2d5b93f234604e369256df75b6a702d3';
    let spaces = [29068433259, 29068433357, 29068433423, 29068433483, 29068433548, 29068433617, 29068433684, 29068433760, 29068433824, 29068433892, 29068433964, 29068434041, 29068434108, 29068434176, 29068434249, 29068434314, 29068434375, 29068434439, 29068434506, 29068434576, 29068434636, 29068434701, 29068434775, 29068434839, 29068434904, 29068434973, 29068435040, 29068435118, 29068435183, 29068435250, 29068435324, 29068435388, 29068435452, 29068435521, 29068435588, 29068435666, 29068435731, 29068435805, 29068435869, 29068435934, 29068436005, 29068436072, 29068436152, 29068436217, 29068436284, 29068436360, 29068436427, 29068436495, 29068436567, 29068436646, 29068436712, 29068436781, 29068436853, 29068436917, 29068436978, 29068437039, 29068437103, 29068437179, 29068437245, 29068437314, 29068437387, 29068437466, 29068437533, 29068437601, 29068437673, 29068437737, 29068437798, 29068437859, 29068437923, 29068438000, 29068438065, 29068438134, 29068438207, 29068438285, 29068438352, 29068438420, 29068438492, 29068438556, 29068438616, 29068438677, 29068438742, 29068438820, 29068438889, 29068438957, 29068439030, 29068439094, 29068439161, 29068439234, 29068439305, 29068439370, 29068439437, 29068439507, 29068439582, 29068439647, 29068439717, 29068439796, 29068439868, 29068439941, 29068440011, 29068440084, 29068440152, 29068440223, 29068440293, 29068440353, 29068440414, 29068440498, 29068440570, 29068440637, 29068440707, 29068440778, 29068440848, 29068440918, 29068440989, 29068441062, 29068441133, 29068441206, 29068441274, 29068441344, 29068441415, 29068441475, 29068441535, 29068441619, 29068441691, 29068441757, 29068441827, 29068441899, 29068441969, 29068442039, 29068442111, 29068442185, 29068442256, 29068442329, 29068442397, 29068442467, 29068442537, 29068442597, 29068442662, 29068442747, 29068442819, 29068442885, 29068442956, 29068443027, 29068443098, 29068443168, 29068443246, 29068443314, 29068443383, 29068443455, 29068443520, 29068443587, 29068443658, 29068443729, 29068443795, 29068443862, 29068443931, 29068444006, 29068444085, 29068444154, 29068444223, 29068444296, 29068444362, 29068444430, 29068444504, 29068444577, 29068444643, 29068444710, 29068444781, 29068444856, 29068444923, 29068444986, 29068445071, 29068445139, 29068445211, 29068445281, 29068445353, 29068445423, 29068445494, 29068445567, 29068445637, 29068445708, 29068445774, 29068445845, 29068445908, 29068445969, 29068446027, 29068446092, 29068446162, 29068446242, 29068446303, 29068446375, 29068446460, 29068446525, 29068446593, 29068446664, 29068446736, 29068446807, 29068446881, 29068446953, 29068447025, 29068447093, 29068447159, 29068447227, 29068447292, 29068447372, 29068447437, 29068447505, 29068447577, 29068447643, 29068447720, 29068447781, 29068447850, 29068447915, 29068447982, 29068448048, 29068448120, 29068448187, 29068448259, 29068448331, 29068448396, 29068448462, 29068448528, 29068448589, 29068448654, 29068448725, 29068448786, 29068448859, 29068448924, 29068448985, 29068449046, 29068449116, 29068449194, 29068449263, 29068449336, 29068449406, 29068449471, 29068449542, 29068449607, 29068449679, 29068449742, 29068449822, 29068449896, 29068449964, 29068450035, 29068450101, 29068450173, 29068450237, 29068450304, 29068450371, 29068450452, 29068450519, 29068450583, 29068450647, 29068450717, 29068450790, 29068450856, 29068450921, 29068451003, 29068451073, 29068451134, 29068451195, 29068451260, 29068451331, 29068451411, 29068451472, 29068451551, 29068451611, 29068451665, 29068451721, 29068451777, 29068451833, 29068451888, 29068451945, 29068452002, 29068452059, 29068452116, 29068452173, 29068452227, 29068452284, 29068452339, 29068452396, 29068452454, 29068452514, 29068452577, 29068452639, 29068452703, 29068452772, 29068452828, 29068452884, 29068452940, 29068452996, 29068453052, 29068453118, 29068453174, 29068453234, 29068453291, 29068453345, 29068453399, 29068453456, 29068453513, 29068453570, 29068453635, 29068453690, 29068453744, 29068453798, 29068453854, 29068453910, 29068453964, 29068454018, 29068454072, 29068454126, 29068454181, 29068454246, 29068454307, 29068454368, 29068454426, 29068454485, 29068454539, 29068454598, 29068454659, 29068454713, 29068454768, 29068454835, 29068454906, 29068454981, 29068455057, 29068455122, 29068455183, 29068455259, 29068455336, 29068455413, 29068455482, 29068455557, 29068455623, 29068455695, 29068455759, 29068455823, 29068455886, 29068455950, 29068456009, 29068456059, 29068456115, 29068456174, 29068456222, 29068456278, 29068456329];
    // 2D Viewer

    bimsync.loadViewer2d();

    bimsync.setOnViewer2dLoadCallback(function () {
      // Get viewer token url from a server
      $.ajax({
        url: demoTokenUrl + '/viewer-2d-demo-token',
        type: 'GET',
        dataType: 'json',
        success: function (result) {
          $viewer2d.viewer2d('loadUrl', viewer2dUrl);
        },
      });
    });

    $viewer2d.bind('loaded', function (event) {
      console.log('2D Viewer loaded!');
    });

    bimsync.load(['viewer-ui']);

    bimsync.setOnLoadCallback(function () {
      $viewer.viewer({
        translucentOpacity: 0.2,
        enableTouch: true,
        enableClippingPlaneWidget: true,
      });
      $viewer.viewerUI({
        enableJoystick: true,
        enableTouch: true,
        enableKeyboard: true,
        joystickHidden: false,
        joystickColor: 'green',
        joystickPosition: 'bottom-center',
        joystickBorderOffset: '0px',
        enableContextMenu: true,
        viewer2dId: 'viewer-2d',
        enableViewer2dIntegration: true,
        showViewer2dStoreySelect: true,
        showViewer2dLockedNavigationToggle: true,
        set2dLockedNavigationMode: false,
      });

      $.ajax({
        url: demoTokenUrl + '/viewer-3d-demo-token',
        type: 'GET',
        dataType: 'json',
        success: function (result) {
          $viewer.viewer('loadUrl', viewer3dUrl);
        },
      });
    });

    $viewer.bind('viewer.load', function (event) {

      $('#viewer-container').focus();
      $viewer.viewer('clippingPlaneWidgetViewport',
        { x: 0, y: 0, width: 150, height: 150 });

      $viewer.viewerUI('setSpaces', spaces);

      console.log('Viewer loaded!');

      $viewer.viewer('modelInfo', function (modelInfos) {
        console.log(modelInfos);
        // This will print model info for all loaded models
      });
    });
  }

  ToogleSpaceVisibility() {
    let $viewer = $('#viewer-3d') as any;
    $viewer.viewerUI('setSpacesVisible', this.spacesVisibility);
  }

  ToogleModelVisibility(model: IModel) {
    let $viewer = $('#viewer-3d') as any;
    if (model.isVisible){
      $viewer.viewer('hideModel', model.id);
    }
    else
    {
      $viewer.viewer('showModel', model.id);
      
    }
    
  }
}

export interface IModel {
  id: string;
  name: string;
  isVisible: boolean;
}


